<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#6c63ff',
              'primary-hover': '#5a52d5',
              'dark-bg': '#1a1a2e',
              'dark-card': '#242442',
              'dark-border': '#444',
              'green-brand': '#2c5530',
              'green-brand-hover': '#1e3d22',
            }
          }
        }
      }
    </script>
    <title>Conductor - Sign Contract</title>
</head>
<body class="font-sans leading-relaxed text-gray-800 bg-gray-100">
    <div class="max-w-[600px] mx-auto py-10 px-5">
        <header class="text-center mb-10">
            <h1 class="text-3xl text-green-brand mb-2.5">Conductor</h1>
            <p class="text-gray-500">Sign & Return Contract</p>
        </header>

        <div class="bg-white rounded-xl p-8 shadow-md">
            <div class="bg-green-50 border-l-4 border-green-brand p-4 mb-6 rounded-r-lg">
                <h3 class="text-green-brand mb-2">Instructions</h3>
                <p class="text-gray-600 text-[0.95rem]">Please sign the proposal PDF you received and upload it below. Once we receive your signed contract, we'll send you an invoice for payment.</p>
            </div>

            <form id="contract-form">
                <div class="mb-5">
                    <label for="job_id" class="block mb-1.5 font-medium text-gray-600">Job Reference</label>
                    <input type="text" id="job_id" name="job_id" required
                           placeholder="From your proposal email"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label for="client_name" class="block mb-1.5 font-medium text-gray-600">Your Name</label>
                    <input type="text" id="client_name" name="client_name" required
                           placeholder="As signed on contract"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label for="client_email" class="block mb-1.5 font-medium text-gray-600">Your Email</label>
                    <input type="email" id="client_email" name="client_email" required
                           placeholder="you@example.com"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label class="block mb-1.5 font-medium text-gray-600">Signed Contract PDF</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center cursor-pointer transition-colors hover:border-green-brand" onclick="document.getElementById('file').click()">
                        <input type="file" id="file" name="signed_contract" accept=".pdf" required class="hidden">
                        <div class="text-gray-500">Click to upload signed contract</div>
                        <div class="text-sm text-gray-400 mt-2">PDF format only</div>
                        <div class="mt-2.5 text-green-brand font-medium" id="file-name"></div>
                    </div>
                </div>

                <div class="flex items-start gap-3 mb-6">
                    <input type="checkbox" id="agree" name="agree" required class="mt-1 w-[18px] h-[18px]">
                    <label for="agree" class="mb-0 font-normal text-gray-600">I have read and agree to the terms in the proposal, including scope of work, pricing, and turnaround time.</label>
                </div>

                <button type="submit" class="w-full py-3.5 bg-green-brand text-white border-none rounded-md text-lg font-medium cursor-pointer transition-colors hover:bg-green-brand-hover disabled:bg-gray-400 disabled:cursor-not-allowed">Submit Signed Contract</button>
            </form>

            <div class="hidden text-center py-10 px-5" id="success">
                <h2 class="text-green-brand mb-2.5">Contract Received!</h2>
                <p>Thank you! You'll receive an invoice shortly with payment instructions.</p>
            </div>
        </div>

        <footer class="text-center mt-10 text-gray-400 text-sm">
            <p>Powered by Irrigation Engineers, Inc.</p>
        </footer>
    </div>

    <script>
        const form = document.getElementById('contract-form');
        const fileInput = document.getElementById('file');
        const fileName = document.getElementById('file-name');
        const success = document.getElementById('success');

        // Pre-fill from URL params
        const params = new URLSearchParams(window.location.search);
        if (params.get('job')) document.getElementById('job_id').value = params.get('job');
        if (params.get('email')) document.getElementById('client_email').value = params.get('email');
        if (params.get('name')) document.getElementById('client_name').value = params.get('name');

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = e.target.files[0].name;
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = form.querySelector('button');
            button.disabled = true;
            button.textContent = 'Submitting...';

            const formData = new FormData(form);

            try {
                const response = await fetch('/api/flows/contracts', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    form.style.display = 'none';
                    success.style.display = 'block';
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                alert('Something went wrong. Please try again.');
                button.disabled = false;
                button.textContent = 'Submit Signed Contract';
            }
        });
    </script>
</body>
</html>
