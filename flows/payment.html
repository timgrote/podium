<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#6c63ff',
              'primary-hover': '#5a52d5',
              'dark-bg': '#1a1a2e',
              'dark-card': '#242442',
              'dark-border': '#444',
              'green-brand': '#2c5530',
              'green-brand-hover': '#1e3d22',
            }
          }
        }
      }
    </script>
    <title>Podium - Submit Payment Receipt</title>
</head>
<body class="font-sans leading-relaxed text-gray-800 bg-gray-100">
    <div class="max-w-[500px] mx-auto py-10 px-5">
        <header class="text-center mb-10">
            <h1 class="text-3xl text-green-brand mb-2.5">Podium</h1>
            <p class="text-gray-500">Submit ACH Payment Receipt</p>
        </header>

        <div class="bg-white rounded-xl p-8 shadow-md">
            <form id="payment-form">
                <div class="mb-5">
                    <label for="invoice" class="block mb-1.5 font-medium text-gray-600">Invoice Number</label>
                    <input type="text" id="invoice" name="invoice" required
                           placeholder="INV-2026-001"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label for="job_id" class="block mb-1.5 font-medium text-gray-600">Job Reference</label>
                    <input type="text" id="job_id" name="job_id" required
                           placeholder="From your invoice"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label for="client_email" class="block mb-1.5 font-medium text-gray-600">Your Email</label>
                    <input type="email" id="client_email" name="client_email" required
                           placeholder="you@example.com"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label for="confirmation" class="block mb-1.5 font-medium text-gray-600">ACH Confirmation / Reference Number</label>
                    <input type="text" id="confirmation" name="confirmation" required
                           placeholder="Bank transfer confirmation number"
                           class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand">
                </div>

                <div class="mb-5">
                    <label class="block mb-1.5 font-medium text-gray-600">Receipt Screenshot (optional)</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center cursor-pointer transition-colors hover:border-green-brand" onclick="document.getElementById('file').click()">
                        <input type="file" id="file" name="receipt" accept=".pdf,.png,.jpg,.jpeg" class="hidden">
                        <div class="text-gray-500">Click to upload receipt</div>
                        <div class="text-sm text-gray-400 mt-2">PDF, PNG, or JPG</div>
                        <div class="mt-2.5 text-green-brand font-medium" id="file-name"></div>
                    </div>
                </div>

                <div class="mb-5">
                    <label for="notes" class="block mb-1.5 font-medium text-gray-600">Notes (optional)</label>
                    <textarea id="notes" name="notes"
                              placeholder="Any additional information..."
                              class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:border-green-brand min-h-[80px] resize-y"></textarea>
                </div>

                <button type="submit" class="w-full py-3.5 bg-green-brand text-white border-none rounded-md text-lg font-medium cursor-pointer transition-colors hover:bg-green-brand-hover disabled:bg-gray-400 disabled:cursor-not-allowed">Submit Payment Receipt</button>
            </form>

            <div class="hidden text-center py-10 px-5" id="success">
                <h2 class="text-green-brand mb-2.5">Receipt Submitted!</h2>
                <p>We'll verify your payment and begin work on your project. You'll receive a confirmation email shortly.</p>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('payment-form');
        const fileInput = document.getElementById('file');
        const fileName = document.getElementById('file-name');
        const success = document.getElementById('success');

        // Pre-fill from URL params
        const params = new URLSearchParams(window.location.search);
        if (params.get('invoice')) document.getElementById('invoice').value = params.get('invoice');
        if (params.get('job')) document.getElementById('job_id').value = params.get('job');
        if (params.get('email')) document.getElementById('client_email').value = params.get('email');

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = e.target.files[0].name;
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = form.querySelector('button');
            button.disabled = true;
            button.textContent = 'Submitting...';

            const formData = new FormData(form);

            try {
                const response = await fetch('/api/flows/payments', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    form.style.display = 'none';
                    success.style.display = 'block';
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                alert('Something went wrong. Please try again.');
                button.disabled = false;
                button.textContent = 'Submit Payment Receipt';
            }
        });
    </script>
</body>
</html>
